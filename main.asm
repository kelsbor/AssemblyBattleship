title AssemblyBattleship

zerar MACRO reg
    xor reg,reg
ENDM

.model small
.data
    ; All playable random matrixes
    MJ0 db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0

    MJ1 db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0
        db 0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0

    MJ2 db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0
        db 0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,1,0
        db 0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0
        db 0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0
        db 0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0

    MJ3 db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0
        db 0,0,0,0,0,0,1,0,0,0,0,0,0,1,1,0,0,0,0,0
        db 0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,0,0,0,0,0
        db 0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0
        db 0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0
        db 0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0

    MJ4 db 1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0
        db 0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,1,1,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1

    MJ5 db 0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0
        db 0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0

    ; Matrix showed to the user
    MATRIXUSER      db 20 dup (20 dup('0'))
                    
    
    ; Matrix where ships are represented
    MATRIXSHIP      db 20 dup (20 dup(?))
                   
    
    ; Send a message requesting the user input for coordinates
    COORDINATES_REQUEST db 10,13,"Digite a coordenada do tiro (x,y): ",10,13,"$"
    
    ; Shot coordinates (X,Y)
    CORDINATES_SHOT db ?,?

    ; Remaining shots of user
    TOTAL_SHOTS db ?

    ; Points variable
    SCORE db ?

.stack 0100h
                    
.code
; Take the user input for the coordinates of the shot
UserShot PROC
    push ax
    push dx

    mov ah, 9
    lea dx, COORDINATES_REQUEST
    int 21h

    pop dx
    pop ax
ret
UserShot ENDP

PrintMatrix PROC
    mov ah, 2
    zerar bx
    zerar si

    jmp_col:
        cmp bx,20
        je jmp_line
        mov dl, MATRIXSHIP[bx + si]
        or dl, 30h
        int 21h
        inc bx
        jmp jmp_col

    jmp_line:
        cmp si,380
        je finish_matrix
        mov dl, 10
        int 21h
        add si,20
        zerar bx
        jmp jmp_col
    
    finish_matrix:
    ret
PrintMatrix ENDP

Random PROC
    mov ah, 0 ; Function that takes the sistem time
    int 1ah   ; Receive time in cx:dx
    mov ax, dx
    zerar dx
    mov bx, 6
    div bx
    ret
ENDP

RandomMatrix PROC
    call Random
    cmp dx,0
    je Level0
    cmp dx,1
    je Level1
    cmp dx,2
    je Level2
    cmp dx,3
    je Level3
    cmp dx,4
    je Level4
    cmp dx,5
    je Level5

Level0:
    lea si, MJ0
    call copy_matrix
    jmp FRM
Level1:
    lea si, MJ1
    call copy_matrix
    jmp FRM
Level2:
    lea si, MJ2
    call copy_matrix 
    jmp FRM
Level3:
    lea si, MJ3
    call copy_matrix
    jmp FRM
Level4:
    lea si, MJ4
    call copy_matrix
    jmp FRM
Level5:
    lea si, MJ5
    call copy_matrix
    jmp FRM

FRM:
ret
RandomMatrix ENDP

copy_matrix PROC
    lea di, MATRIXSHIP
    mov cx,400
    cld
    rep movsb
    ret
ENDP

main PROC
    mov ax, @data
    mov ds, ax
    mov es, ax

    call RandomMatrix
    call PrintMatrix
    call UserShot

    mov ah, 4CH
    int 21h 
main ENDP
END main
